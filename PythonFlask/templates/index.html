<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<!-- <link rel="stylesheet" href="css/bootstrap_jkl.css">
    <script src="js/jquery.1.12.4.min.js"></script>
    <script src="js/bootstrap.js"></script> -->
<!--
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script> -->
    <link rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="static/assets/css/main.css">
    <link href="static/assets/css/application.css" rel="stylesheet">
    <link href="static/assets/css/toolkit.css" rel="stylesheet">

    <title>NEWS AGGREGATOR</title>
</head>
<body>
<nav class="navbar navbar-expand-md fixed-top navbar-dark bg-primary app-navbar" style="height:30px">
  <a id="brand" class="navbar-brand" href="#" onclick="loadNews(1,'',1)" style="color:white; font-weight: 600;">NEWS AGGREGATOR</a>

  <div class="collapse navbar-collapse" id="navbarResponsive">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#" onclick="loadNews(1,'',1)">Home </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#listTitle">Hotspot</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="loadNews(1,'',0,'Global')">Global</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="loadNews(1,'',0,'Australia')">Australia</a>
      </li>
    </ul>

    <form class="form-inline float-right d-none d-md-flex">
      <input id="searchKeyword"  class="form-control" type="text" data-action="grow" placeholder="Search">
    </form>

    <ul id="#js-popoverContent" class="nav navbar-nav float-right mr-0 d-none d-md-flex">
      <li class="nav-item">
        <a class="app-notifications nav-link" >
          <span class="icon icon-arrow-right" onclick="searchNews()"></span>
        </a>
      </li>
    </ul>

  </div>
</nav>
    <div class="rating-container rating-lg rating-animate">

    <div id="myCarousel" class="carousel slide" style="margin-top:40px">
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
            <li data-target="#myCarousel" data-slide-to="2"></li>
        </ol>

        <div class="carousel-inner">
            <div class="item active" align="center" >
                <img src="static/assets/news_images/img1.png" alt="First slide">
            </div>
            <div class="item" align="center" >
                <img src="static/assets/news_images/img1.png" alt="Second slide">
            </div>
            <div class="item" align="center" >
                <img src="static/assets/news_images/img1.png" alt="Third slide">
            </div>
        </div>
        <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>



    <div class="container">
        <div class="row">

            <div class="col-sm-3">
                <div class = "post-list-title" style="text-align: center;font-weight: 700;color: #3097d1; margin-top:30px">
                    <h4>Latest News</h4>
                </div>
                <div class="panel-body">
                <div class="list-group" id="acTableLatest">
                </div>
                </div>
            </div>


            <div class="col-sm-8">
                <div class="panel panel-warning " style="margin-top: 20px;">
                <div class="panel-heading" style="background-color: #3097d1;color:#FFFFFF">
                    <h2 id="listTitle" class="post-list-title" >GLOBAL NEWS</h2>
                </div>
                <div class="panel-body">
                    <div class="list-group" id = "actTable">

                    </div>


                </div>

                <ul id="change_page" class="pagination" align="center">
                    <li id="pre"><a onclick="loadNews(0)">&laquo;</a></li>
                    <li id="page_1" onclick="loadNews(1)"><a  href="#listTitle">1</a></li>
                    <li id="page_2" onclick="loadNews(2)"><a  href="#listTitle">2</a></li>
                    <li id="page_3" onclick="loadNews(3)"><a  href="#listTitle">3</a></li>
                    <li id="page_4" onclick="loadNews(4)"><a  href="#listTitle">4</a></li>
                    <li id="page_5" onclick="loadNews(5)"><a  href="#listTitle">5</a></li>
                    <li id="page_6" onclick="loadNews(6)"><a  href="#listTitle">6</a></li>
                    <li id="page_7" onclick="loadNews(7)"><a  href="#listTitle">7</a></li>
                    <li id="page_8" onclick="loadNews(8)"><a  href="#listTitle">8</a></li>
                    <li id="page_9" onclick="loadNews(9)"><a  href="#listTitle">9</a></li>
                    <li id="next"><a onclick="loadNews(10)">&raquo;</a></li>
                </ul>
            </div>
            </div>


            </div>
        </div>
    </div>


    <div class = "footer-area">
            <div class = "main-footer-area">
                <div class="container">
                    <div class = "row">
                        <div class="col-12 col-sm-6 col-lg-2">
                            <div class="footer-widget-area mt-5">
                                <h3 class="widget-title">Contact</h3>
                                <ul class="footer-list">
                                    <li><a href="#" class="footer-word">gpu.jkl.io:5000</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-12 col-sm-4 col-lg-2">
                             <div class="footer-widget-area mt-5">
                                <h3 class="widget-title">Featured</h3>
                                <ul class="footer-list">
                                    <li><a onclick="loadNews(1,'',0,'Australia')" href="#" class="footer-word">Australian</a></li>
                                    <li><a onclick="loadNews(1,'',0,'Global')" href="#" class="footer-word">Global</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script type="text/javascript">

        $(document).ready(
            loadNews(1,"",0,"Global")
        );
        $('.img-responsive').on('click',function () {
             console.log('as')
          });


        function loadNews(page=1, keyword = "",reload=0, cate=""){
             url= "test_get"
             if (keyword == ""){
                 if (reload == 1){
                    $('#listTitle').text('Global News')
                 }
                 if (cate != ""){
                    $('#listTitle').text(cate+' News')
                 }
             }else{
                url= "search_news"
             }

             if (page == 0){
                  page =  parseInt(localStorage.getItem('page'))
                  page -= 1
             }else if (page == 10){
                  page = parseInt(localStorage.getItem('page'))
                  page += 1
             }
             console.log(page)
             data = {"page": page, "cate":cate}


             var title = $('#listTitle').html()
             if (keyword!= "" || title.substring(0, 19).indexOf("Search Result") != -1){
                if (keyword == ""){
                    keyword = title.substring(20,title.length-1)
                }
                url= "search_news"
                data["keyword"]=  keyword
             }else{
                cate = title.split(' ')[0]
                data["cate"] = cate
             }

             $.ajax({
                url: url,
                type: "get",
                dataType: "text",
                data:data,
                success: function (data) {
                    $("#actTable").empty();
                    $("#change_page").empty();
                    var jsonText = JSON.parse(data);
                    var actResult = ""
                    var max_page = Math.ceil(parseFloat(jsonText[0])/10)
                    change_page = '<li id="pre" onclick="loadNews(0)"><a href="#listTitle">&laquo;</a></li>'
                    for (var i =1;i<max_page+1;i++){
                        change_page += '<li onclick="loadNews('+i+')"><a id="page_'+i+'" href="#listTitle">'+i+'</a></li>'
                    }
                    change_page +=  '<li onclick="loadNews(10)" id="next"><a href="#listTitle">&raquo;</a></li>'
                    $('#change_page').append(change_page);

                    for (var i = 1; i < jsonText.length; i++) {
                        var score = Number(jsonText[i].timerank * 100).toFixed(1)
                        var date_new = timestampToTime(parseInt(jsonText[i].publish_date)-28800)
                        img_url = "abc.png"
                        img_ref = "http://www.abc.net.au"
                        if (jsonText[i].url.toString().substring(0,20).indexOf("sbs") != -1){
                            img_url = "sbs.png"
                            img_ref = "http://www.sbs.com.au"
                        }else if (jsonText[i].url.toString().substring(0,20).indexOf("can") != -1){
                            img_url = "cbr_times.png"
                            img_ref="http://www.canberratimes.com.au"
                        }
                        score += "%"
                        actResult +=
                        '<div  class="list-group-item col-sm-12" style="padding:10px 15px 0px 15px">' +
                        '<div">'+
                            '<a href="'+ img_ref +'">'+
                            '<img src="../static/assets/image/'+img_url+'" class="img-responsive" style="float:left;height:15px;padding-top: 2px;"></a>' +
                            '<div href="#" class="timeline-category-name">'+jsonText[i].category+'</div>'+

                            '<div href="#">'+
                                '<h5 class="timeline-post-title">'+ '<a href = "'+jsonText[i].url+'">' + jsonText[i].title + '</a>'+'</h5>'+
                            '</div>'+
                            '<div class="timeline-post-info">'+
                                '<p href="#" >'+date_new+'</p>'+
                            '</div>'+
                            '<img id="'+jsonText[i].news_id+'_d" src="../static/assets/image/arrow_static.png" class="img-responsive" onclick="comment(this)" style="float:right;height:15px;padding-top: 0px;">'+
                            '<p id="'+jsonText[i].news_id+'_disapprove_num" style="float:right;">'+jsonText[i].disapprove+'</p>' +
                            '<img id="'+jsonText[i].news_id+'_a" src="../static/assets/image/arrow_static.png" class="img-responsive" onclick="comment(this)" style="float:right;height:15px;padding-top: 0px; margin-right:10px">'+
                            '<p id="'+jsonText[i].news_id+'_approve_num" style="float:right;">'+jsonText[i].approve+'</p>' +
                        '</div>'+
                        '</div>'
                    }
                    $('#actTable').append(actResult);

                    target_page = "page_" + page
                    $("#" + target_page + "").css("background", "yellow")
                    localStorage.setItem('page',page)
                    if (page == max_page){
                        $('#next').removeAttr('onclick')
                    }
                    if (page == 1){
                        $('#pre').removeAttr('onclick')
                    }
                },
                error: function (data) {
                    console.log("no News");
                }
            });
            loadLatestNews()
        }

        function searchNews(){
            if ($('#searchKeyword').val() == null || $('#searchKeyword').val() == ""){
                alert("no keywords")
            }else {
                var keywords = $('#searchKeyword').val()
                $('#listTitle').text('Search Results for "' + keywords + '"')
                loadNews(1, keywords)
            }
        }

        function comment(btn){
            var id_comment = btn.getAttribute('id')
            var id = id_comment.split('_')[0]
            var comment = id_comment.split('_')[1]
            $.ajax({
                url: "comment",
                type: "get",
                dataType: "text",
                data:{"news_id": parseInt(id), "comment_type":comment},
                success: function (data) {
                    var jsonText = JSON.parse(data)
                    if (jsonText.status == 1){
                        var app_num = '#'+id+'_approve_num'
                        var disapp_num = '#'+id+'_disapprove_num'
                        $(app_num).html(jsonText.approve)
                        $(disapp_num).html(jsonText.disapprove)
                        alert('commented!')
                    }else{
                        alert('You have already commented!')
                    }
                },
                error: function (data) {
                    console.log("service err");
                }
            });
        }

        function loadLatestNews(){
             $.ajax({
                url: "test_get_latest",
                type: "get",
                dataType: "text",
                success: function (data) {
                    $("#acTableLatest").empty();
                    var jsonText = JSON.parse(data);
                    var actResult = ""
                    for (var i = 0; i < jsonText.length; i++) {
                        var score = Number(jsonText[i].timerank)
                        var date_new = timestampToTime(parseInt(jsonText[i].publish_date)-28800)
                        actResult +=
                        '<a href="'+jsonText[i].url+'" class="list-group-item col-sm-12">' +
                        '<div href="#">'+
                                '<h5 class="timeline-post-title">'+jsonText[i].title+'</h5>'+
                            '</div>'+
                            '<div class="timeline-post-info">'+
                                '<div href="#" style="font-size:12px">Score: '+score+'</div>'+
                                '<div href="#" style="font-size:12px">'+date_new+'</div>'+
                         '</div>'

                    }
                    $('#acTableLatest').append(actResult);
                },
                error: function (data) {
                    console.log("no News");
                }
            });
        }


        function timestampToTime(timestamp) {
            var date = new Date(timestamp * 1000);
            var Y = date.getFullYear() + '-';
       var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
       var D = date.getDate() + ' ';
       var h = date.getHours() + ':';
       var m = (date.getMinutes() < 10 ? '0'+(date.getMinutes()) : date.getMinutes()) + ':';
       var s =  (date.getSeconds() < 10 ? '0'+(date.getSeconds()) : date.getSeconds())
       return Y+M+D+h+m+s;
        }


        $('.search-toggle').on('click', function(e){
            e.preventDefault();
            $('.search-bar').toggleClass('active');
        });


        $(function(){
             var _width = $(window).width();
             if(_width > 844){
                 $("#brand").css("margin-top","10px");
             }
        });
    </script>

</body>
</html>
